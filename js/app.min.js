window.addEventListener('DOMContentLoaded', () => {
	_icon_menu()

	let leftbar = $('.dashboard__left-bar')
	if(window.innerWidth > 800){
		$(leftbar).addClass('not_mobile')
	}

	let imagePreview = $('.image-preview').toArray()
	jQuery.each(imagePreview, (item, i) => {
		$(i).click(function (e) {
			$(i).closest('.main-item__image').toggleClass('_active')
		})
	})

	let galerie = $('.galerie').toArray()
	jQuery.each(galerie, (item, i) => {
		$(i).click(function (e) {
			$(i).closest('.main-item__image').toggleClass('_active')
			$(i).toggleClass('_active')
		})
	})

	let node = $('.main-item').toArray()
	let popup = $('.popup__buttons')

	jQuery.each(node, (item, i) => {
		$(i).mousedown(function (e) {
			if(e.button == 2){
				$(popup).addClass('_active')
				$(popup).addClass('_blocked')

				$(e.currentTarget).addClass('_show')
				$('.shadow').addClass('_show')

				
				var elem = $('.right-bar__main')

				if(e.currentTarget.offsetTop - elem.scrollTop() > 104){
					console.log(123123)
					if($(e.currentTarget).hasClass('rigth') == true){
						popup.css({ 
							left: `${e.currentTarget.offsetLeft}px`,
							top: `${e.currentTarget.offsetTop + 45}px` ,
							transform: `translate(0,-100%)`
						})
					}else{
						popup.css({ 
							left: `${e.currentTarget.offsetLeft + $(e.currentTarget).context.offsetWidth}px`,
							top: `${e.currentTarget.offsetTop + 45}px` ,
							transform: `translate(-100%,-100%)`
						})
					}
				}else{
					if($(e.currentTarget).hasClass('rigth') == true){
						popup.css({ 
							left: `${e.currentTarget.offsetLeft}px`,
							top: `${e.currentTarget.offsetTop + e.currentTarget.offsetHeight + 12}px` ,
							transform: `translate(0,0)`
						})
					}else{
						popup.css({ 
							left: `${e.currentTarget.offsetLeft + $(e.currentTarget).context.offsetWidth}px`,
							top: `${e.currentTarget.offsetTop + e.currentTarget.offsetHeight + 12}px` ,
							transform: `translate(-100%,0)`
						})
					}
				}
			}
		}).mouseup(function (e) {
			setTimeout(() => {
				$(popup).removeClass('_blocked')
			}, 100);
		})
	})

	$('.wrapper').mousedown(function (e) {
		if (e.target.classList.value != 'popup__buttons _active') {
			if($(popup).hasClass('_blocked') == false){
				jQuery.each(node, (item, i) => {
					$(i).removeClass('_show')
				})

				$('.shadow').removeClass('_show')
				$(popup).removeClass('_active')
			}
			let galeries = $('.galerie').toArray()

			jQuery.each(galeries, (item, i) => {
				$(i).removeClass('no_active')
			})

			let images = $('.main-item__image').toArray()
			jQuery.each(images, (item, i) => {
				$(i).removeClass('_active')
			})
		}
	})

	let items = $('.item__content').toArray()
	jQuery.each(items, (item, i) => {
		$(i).click(function (e) {
			let dashboard = document.querySelector('.dashboard__left-bar')
			let iconMenu = document.querySelector('.icon-menu')
			$(dashboard).removeClass('_active')
			$(iconMenu).removeClass('_active')

			jQuery.each(items, (_item, _i) => {
				$(_i).removeClass('_active')
			})

			$(i).addClass('_active')
		})
	})

	var pointerEventToXY = function(e){
		var out = {x:0, y:0};
		if(e.type == 'touchstart' || e.type == 'touchmove' || e.type == 'touchend' || e.type == 'touchcancel'){
			var touch = e.originalEvent.touches[0] || e.originalEvent.changedTouches[0];
			out.x = touch.pageX;
			out.y = touch.pageY;
		} else if (e.type == 'mousedown' || e.type == 'mouseup' || e.type == 'mousemove' || e.type == 'mouseover'|| e.type=='mouseout' || e.type=='mouseenter' || e.type=='mouseleave') {
			out.x = e.pageX;
			out.y = e.pageY;
		}
		return out;
	};


	var timer

	$('.right-bar__main').scroll(function () {
		clearTimeout(timer)
	})

  document.oncontextmenu = function() {return false;};
	let _items = $('.main-item').toArray()
	jQuery.each(_items, (item, i) => {
		if(window.innerWidth > 1300){
			$(i)
			.on('mousedown', function (e) {
				if(e.buttons == 1){
					timer = setTimeout(function () {
						if (e.target.classList.value == 'image-preview') {
							$(e.target).closest('.main-item__image').children('.galerie').addClass('no_active')
						}
						$(popup).toggleClass('_active')
	
						$(e.currentTarget).addClass('_show')
						$('.shadow').addClass('_show')
	
						var elem = $('.right-bar__main')

						if(e.currentTarget.offsetTop - elem.scrollTop() > 104){
							if($(e.currentTarget).hasClass('rigth') == true){
								popup.css({ 
									left: `${e.currentTarget.offsetLeft}px`,
									top: `${e.currentTarget.offsetTop + 45}px` ,
									transform: `translate(0,-100%)`
								})
							}else{
								popup.css({ 
									left: `${e.currentTarget.offsetLeft + $(e.currentTarget).context.offsetWidth}px`,
									top: `${e.currentTarget.offsetTop + 45}px` ,
									transform: `translate(-100%,-100%)`
								})
							}
						}else{
							if($(e.currentTarget).hasClass('rigth') == true){
								popup.css({ 
									left: `${e.currentTarget.offsetLeft}px`,
									top: `${e.currentTarget.offsetTop + e.currentTarget.offsetHeight + 12}px` ,
									transform: `translate(0,0)`
								})
							}else{
								popup.css({ 
									left: `${e.currentTarget.offsetLeft + $(e.currentTarget).context.offsetWidth}px`,
									top: `${e.currentTarget.offsetTop + e.currentTarget.offsetHeight + 12}px` ,
									transform: `translate(-100%,0)`
								})
							}
						}
					}, 1 * 500)
				}
				
			})
			.on('mouseup mouseleave', function () {
				clearTimeout(timer)
			})
		}else{
			$(i)
			.on('touchstart', function (e) {
				timer = setTimeout(function () {
					if (e.currentTarget.classList.value == 'image-preview') {
						$(e.currentTarget).closest('.main-item__image').children('.galerie').addClass('no_active')
					}
					$(popup).toggleClass('_active')

					var xPos = pointerEventToXY(e).x
					var elem = $('.right-bar__main')

					//104
					

					if($(leftbar).hasClass('not_mobile')){
						xPos = xPos - leftbar[0].clientWidth
					}

					$(e.currentTarget).addClass('_show')
					$('.shadow').addClass('_show')

					if(e.currentTarget.offsetTop - elem.scrollTop() > 104){
						if($(e.currentTarget).hasClass('rigth') == true){
							popup.css({ 
								left: `${e.currentTarget.offsetLeft}px`,
								top: `${e.currentTarget.offsetTop + 45}px` ,
								transform: `translate(0,-100%)`
							})
						}else{
							popup.css({ 
								left: `${e.currentTarget.offsetLeft + $(e.currentTarget).context.offsetWidth}px`,
								top: `${e.currentTarget.offsetTop + 45}px` ,
								transform: `translate(-100%,-100%)`
							})
						}
					}else{
						if($(e.currentTarget).hasClass('rigth') == true){
							popup.css({ 
								left: `${e.currentTarget.offsetLeft}px`,
								top: `${e.currentTarget.offsetTop + e.currentTarget.offsetHeight + 12}px` ,
								transform: `translate(0,0)`
							})
						}else{
							popup.css({ 
								left: `${e.currentTarget.offsetLeft + $(e.currentTarget).context.offsetWidth}px`,
								top: `${e.currentTarget.offsetTop + e.currentTarget.offsetHeight + 12}px` ,
								transform: `translate(-100%,0)`
							})
						}
					}

				}, 1 * 500)
			})
			.on('touchend', function () {
				clearTimeout(timer)
			})
		}
		
	})

	var audioElement = document.createElement('audio')
	var audiocontentPlay = $('.audiocontent-play')
	audioElement.setAttribute('src', 'files/file.mp3')

	$('.audiocontent').append(audioElement)

	$(audiocontentPlay).mouseup(function (e) {
		if ($(audioElement).hasClass('_active')) {
			audioElement.pause()
			$(audioElement).removeClass('_active')
			$('.audiocontent-play').removeClass('_active')
		} else {
			audioElement.play()
			$(audioElement).addClass('_active')
			$('.audiocontent-play').addClass('_active')
		}
		$(audioElement).addClass('play')
	})

	let cur = $('.Chart__cur')
	setTimeout(() => {
		setInterval(() => {
			let audio = $('audio')
			let audioCurrent = audio[0].currentTime
			let audioDuration = audio[0].duration
			let width = (audioCurrent * 100) / audioDuration
			cur.css({ width: `${width}%` })
		}, 0.1)
	}, 1000)
})

function _icon_menu() {
	let iconMenu = document.querySelector('.icon-menu')
	if (iconMenu != null) {
		let dashboard = document.querySelector('.dashboard__left-bar')
		iconMenu.addEventListener('click', function (e) {
			iconMenu.classList.toggle('_active')
			dashboard.classList.toggle('_active')
		})
	}
}

//для подключения необходимо прописать инклюд в этом файле и вызвать функцию в script.js
