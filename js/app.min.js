window.addEventListener('DOMContentLoaded', () => {
	_icon_menu()

	let imagePreview = $('.image-preview').toArray()
	jQuery.each(imagePreview, (item, i) => {
		$(i).click(function (e) {
			$(i).closest('.main-item__image').toggleClass('_active')
		})
	})

	let galerie = $('.galerie').toArray()
	jQuery.each(galerie, (item, i) => {
		$(i).click(function (e) {
			$(i).closest('.main-item__image').toggleClass('_active')
			$(i).toggleClass('_active')
		})
	})

	let node = $('.main-item').toArray()
	let popup = $('.popup__buttons')

	jQuery.each(node, (item, i) => {
		$(i).dblclick(function (e) {
			$(popup).toggleClass('_active')

			var elm = $('.right-bar__main')
			var xPos = e.pageX - elm.offset().left
			var yPos = e.pageY - elm.offset().top

			popup.css({ left: `${xPos}px`, top: `${yPos + elm.scrollTop()}px` })
		})
	})

	$('.wrapper').mousedown(function (e) {
		//=========================================
		//=========================================
		//=========================================
		//=========================================
		/*let audio = $('audio')
	let audioCurrent = audio[0].currentTime
	let audioDuration = audio[0].duration
	let width = audioCurrent * 100 / audioDuration;
	console.log(width)*/

		//=========================================
		//=========================================
		//=========================================
		//=========================================
		//=========================================
		//=========================================
		//=========================================
		//=========================================

		if (e.target.classList.value != 'popup__buttons _active') {
			$(popup).removeClass('_active')
			let galeries = $('.galerie').toArray()

			jQuery.each(galeries, (item, i) => {
				$(i).removeClass('no_active')
			})

			let images = $('.main-item__image').toArray()
			jQuery.each(images, (item, i) => {
				$(i).removeClass('_active')
			})
		}
	})

	let items = $('.item__content').toArray()
	jQuery.each(items, (item, i) => {
		$(i).click(function (e) {
			let dashboard = document.querySelector('.dashboard__left-bar')
			let iconMenu = document.querySelector('.icon-menu')
			$(dashboard).removeClass('_active')
			$(iconMenu).removeClass('_active')

			jQuery.each(items, (_item, _i) => {
				$(_i).removeClass('_active')
			})

			$(i).addClass('_active')
		})
	})

	var pointerEventToXY = function(e){
		var out = {x:0, y:0};
		if(e.type == 'touchstart' || e.type == 'touchmove' || e.type == 'touchend' || e.type == 'touchcancel'){
			var touch = e.originalEvent.touches[0] || e.originalEvent.changedTouches[0];
			out.x = touch.pageX;
			out.y = touch.pageY;
		} else if (e.type == 'mousedown' || e.type == 'mouseup' || e.type == 'mousemove' || e.type == 'mouseover'|| e.type=='mouseout' || e.type=='mouseenter' || e.type=='mouseleave') {
			out.x = e.pageX;
			out.y = e.pageY;
		}
		return out;
	};


	let _items = $('.main-item').toArray()
	jQuery.each(_items, (item, i) => {
		var timer
		$(i)
			.on('mousedown touchstart', function (e) {
				timer = setTimeout(function () {
					if (e.target.classList.value == 'image-preview') {
						$(e.target).closest('.main-item__image').children('.galerie').addClass('no_active')
					}
					$(popup).toggleClass('_active')

					var elm = $('.right-bar__main')
					var xPos = e.pageX - elm.offset().left
					var yPos = e.pageY - elm.offset().top

					popup.css({ left: `${xPos}px`, top: `${yPos + elm.scrollTop()}px` })
				}, 1 * 1000)
			})
			.on('mouseup mouseleave touchend', function () {
				clearTimeout(timer)
			})
			.on('touchstart', function (e) {
				timer = setTimeout(function () {
					if (e.currentTarget.classList.value == 'image-preview') {
						$(e.currentTarget).closest('.main-item__image').children('.galerie').addClass('no_active')
					}
					$(popup).toggleClass('_active')

					var xPos = pointerEventToXY(e).x
					var yPos = pointerEventToXY(e).y

					popup.css({ left: `${xPos}px`, top: `${yPos}px` })
				}, 1 * 1000)
			})
			.on('touchend', function () {
				clearTimeout(timer)
			})
	})

	var audioElement = document.createElement('audio')
	var audiocontentPlay = $('.audiocontent-play')
	audioElement.setAttribute('src', 'files/file.mp3')

	$('.audiocontent').append(audioElement)

	$(audiocontentPlay).mouseup(function (e) {
		if ($(audioElement).hasClass('_active')) {
			audioElement.pause()
			$(audioElement).removeClass('_active')
		} else {
			audioElement.play()
			$(audioElement).addClass('_active')
		}
		$(audioElement).addClass('play')
	})

	let cur = $('.Chart__cur')
	setTimeout(() => {
		setInterval(() => {
			let audio = $('audio')
			let audioCurrent = audio[0].currentTime
			let audioDuration = audio[0].duration
			let width = (audioCurrent * 100) / audioDuration
			cur.css({ width: `${width}%` })
		}, 0.1)
	}, 1000)
})

function _icon_menu() {
	let iconMenu = document.querySelector('.icon-menu')
	if (iconMenu != null) {
		let dashboard = document.querySelector('.dashboard__left-bar')
		iconMenu.addEventListener('click', function (e) {
			iconMenu.classList.toggle('_active')
			dashboard.classList.toggle('_active')
		})
	}
}

//для подключения необходимо прописать инклюд в этом файле и вызвать функцию в script.js
